#### Stack

- Python
- Django, DRF
- PostgreSQL, PostGIS, DjangoORM, Redis
- Celery, Swagger
- isort, flake8, pip
- Docker, NGINX

local address: http://127.0.0.1:8000/swagger/
deploy address: http://81.163.29.117/swagger/

### Описание проекта

Представленный проект реализован в рамках тестового задания.<br>
<br>
#### Задание:
1. Создать модель участников. У участника должна быть аватарка, пол, имя и фамилия, почта.
2. Создать эндпоинт регистрации нового участника: /api/clients/create (не забываем о пароле и совместимости с авторизацией модели участника).
3. При регистрации нового участника необходимо обработать его аватарку: наложить на него водяной знак (в качестве водяного знака можете взять любую картинку).
4. Создать эндпоинт оценивания участником другого участника: /api/clients/{id}/match. В случае, если возникает взаимная симпатия, то ответом выдаем почту клиенту и отправляем на почты участников: «Вы понравились <имя>! Почта участника: <почта>».
5. Создать эндпоинт списка участников: /api/list. Должна быть возможность фильтрации списка по полу, имени, фамилии. Советую использовать библиотеку Django-filters.
6. Реализовать определение дистанции между участниками. Добавить поля долготы и широты. В api списка добавить дополнительный фильтр, который показывает участников в пределах заданной дистанции относительно авторизованного пользователя. Не забывайте об оптимизации запросов к базе данных
https://en.wikipedia.org/wiki/Great-circle_distance
7. Задеплоить проект на любом удобном для вас хостинге, сервисах PaaS (Heroku) и т.п. Должна быть возможность просмотреть реализацию всех задач. Если есть какие-то особенности по тестированию, написать в Readme. Там же оставить ссылку/ссылки на АПИ проекта
- Приветствуется:
Аккуратный код
Соблюдение PEP8 (Pycodestyle)


## Инструкция по установке и использованию API локально

1. Установите Docker или Docker-desktop, если он еще не установлен.

2. Клонируйте репозиторий в заранее созданную папку

```bash
cd <folder_name>
git clone ...
```

3. Перейдите в директорию проекта и создайте файл `.env` и заполните
данными как в файле `.env-sample` - необходимо для конфигурации подключения
к базе данных и формироваия токена доступа, так же здесь настроена отправка электронных писем через гугл:<br>
Создайте в гугл акаунте двухфакт. аут. и затем получите пароль приложений. Добавьте почту и пароль приложений в .env.

4. Далее Вам необходимо выполнить команду из корневой директории проекта:
```bash
docker-compose up --build
```

5. Если Вы сделали все корректно, то после команды `docker-compose up --build`
должны выполниться:
- установка всех необходимых зависимостей
- миграция (создание таблиц в базе данных)
- автозаполнение заранее подготовленными данными в таблицы
- поднятие всех необходимых сервисов для корректной работы приложения
- запуск сервера, который будет доступен по адресу http://127.0.0.1:8000/swagger/


### Общая инструкция по использованию API как локально так и на VPS

- Тестовые данные:
```
id=1, user1@example.com : Password.1
id=2, user2@example.com : Password.1
id=3, user3@example.com : Password.1
id=4, user4@example.com : Password.1
id=5, user5@example.com : Password.1
id=6, shved.dev15@gmail.com : Password.1
```

1. Перейдите по адресу http://81.163.29.117/swagger/ (deployed) или http://127.0.0.1:8000/swagger/ (local) что бы посмотреть документацию API
2. Создание нового участника:
- без аватара:
необходимо по ендпоинту `/swagger/` внести необходимые данные в эндпоинте `POST`: `/clients/create/`:
```
{
  "email": "user@example.com",
  "first_name": "string",
  "last_name": "string",
  "gender": "M",
  "password": "string",
  "password2": "string"
}
```

И выполнить, нажав кнопку `Execute`. После чего должен вернуться response с созданием участника - к нему будет подгружаться дефолтный аватар без наложения водяного знака.
- с аватаром:
постучитесь по адресу `/clients/create/` и заполните форму - загрузив аватар, на него будет наложен водяной знак и данный сохранятся в БД.

3. Что бы лайкнуть пользователя, перейдите по адресу `/swagger/` и выберите ендпоинт `POST`:`/clients/{from_user_id}/match/`.<br>
Для совершения данного действия необходимо авторизоваться, поэтому нажимаем на замок этого ендпоинта и вводим тестовые данные приведенные выше, после этого пробуем поставить лайк:
```
{
  "to_user": 0
}
```
вбиваем id юзера, которому хотим поставить лайк, ниже вбиваем от кого хотим поставить лайк (от своего id)<br>
При macth на почту придет об этом электронное письмо
4. Просмотр списка участников с фильтрацией:
Перейдите на ендпоинт `GET`:`/list/` по адресу `/swagger/`  и предварительно авторизуйтесь с тестовыми данными (нажать на замок ендпоинта и ввести данные)<br>
Далее можно получить просто список участников без филтрации нажав на `Execute`, можно произвести фильтрацию по полу, имени, фамилии. (данные фильтруются вне зависимости от регистра, но сохраняя уникальность, так как тестовые данные похожи и в целях демонстрации я посчитал что так лучше)<br>
Так же можно вставить широту и долготу в поля latitude (55.740666771669595), longitude (37.666353669593065) и  выбрать радиус (км), тогда данные обновятся в базе данных и в response придут все пользователи в заданном радиусе + расстояние до них:
```
  {
    "first_name": "User2",
    "last_name": "Name2",
    "gender": "W",
    "avatar": "http://81.163.29.117/media/default/default_avatar.png",
    "location": "SRID=4326;POINT (55.740654692295294 37.66630002541707)",
    "distance": 0.76867615329
  },
  {
    "first_name": "User3",
    "last_name": "Name3",
    "gender": "M",
    "avatar": "http://81.163.29.117/media/default/default_avatar.png",
    "location": "SRID=4326;POINT (55.73501033708949 37.655446082793866)",
    "distance": 2.04250906349
  },
```

5. Развертывание в целях экономии времени было реализовано без домена, файрвола и сертификата.
6. Так же в целях экономии времени не были написаны тесты.